{% extends "base.html" %}
{% block content %}
    <h1 class="mb-4">Quản lý Huynh Trưởng & Dự Trưởng</h1>
    <div class="mb-3">
        <a href="{{ url_for('leader.add_leader') }}" class="btn btn-primary">Thêm Huynh Trưởng & Dự Trưởng</a>
        <a href="{{ url_for('leader.import_leaders') }}" class="btn btn-info">Nhập từ File</a>
        <a href="{{ url_for('leader.export_leaders') }}" class="btn btn-success">Xuất Excel</a>
    </div>
    <form method="GET" class="mb-3">
        <div class="row">
            <div class="col-md-4">
                <label for="role_filter" class="form-label">Lọc theo vai trò</label>
                <select name="role_filter" id="role_filter" class="form-select" onchange="this.form.submit()">
                    <option value="">Tất cả vai trò</option>
                    <option value="huynh_truong" {% if request.args.get('role_filter') == 'huynh_truong' %}selected{% endif %}>Huynh Trưởng</option>
                    <option value="du_truong" {% if request.args.get('role_filter') == 'du_truong' %}selected{% endif %}>Dự Trưởng</option>
                </select>
            </div>
        </div>
    </form>
    <div class="table-responsive card-shadow">
        <table class="table table-striped table-hover">
            <thead class="thead-dark">
                <tr>
                    <th>ID</th>
                    <th>Username</th>
                    <th>Họ Tên</th>
                    <th>Tên Thánh</th>
                    <th>Vai Trí</th>
                    <th>Email</th>
                    <th>Lớp được phân công</th>
                    <th>Hành động</th>
                </tr>
            </thead>
            <tbody>
                {% for leader in leaders %}
                <tr>
                    <td>{{ leader.id }}</td>
                    <td>{{ leader.username }}</td>
                    <td>{{ leader.profile.ho_ten }}</td>
                    <td>{{ leader.profile.ten_thanh or 'N/A' }}</td>
                    <td><span class="badge badge-secondary">{{ 'Huynh trưởng' if leader.role == 'huynh_truong' else 'Dự trưởng' }}</span></td>
                    <td>{{ leader.email }}</td>
                    <td>
                        {% for class in leader.assigned_classes %}
                        <div class="d-flex align-items-center mb-1">
                            <span class="badge badge-info mr-2">{{ class.name }}</span>
                            <form action="{{ url_for('admin.assign_leader') }}" method="POST" class="d-inline">
                                <input type="hidden" name="class_id" value="{{ class.id }}">
                                <input type="hidden" name="leader_id" value="{{ leader.id }}">
                                <input type="hidden" name="action" value="unassign">
                                <button type="submit" class="btn btn-sm btn-outline-danger" title="Gỡ phân công">Gỡ</button>
                            </form>
                        </div>
                        {% endfor %}
                        {% if not leader.assigned_classes %}
                        <span class="text-muted">Chưa phân công</span>
                        {% endif %}
                    </td>
                    <td>
                        <a href="{{ url_for('leader.edit_leader', user_id=leader.id) }}" class="btn btn-secondary btn-sm">Sửa</a>
                        <form action="{{ url_for('leader.delete_leader', user_id=leader.id) }}" method="POST" class="d-inline">
                            <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Bạn có chắc chắn muốn xóa Huynh Trưởng này?')">Xóa</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endblock content %}
